<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</title>
    <link rel="stylesheet" href="css/menu1.1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <div class="header">
        <h2>User ‡∏¢‡∏∑‡∏° </h2>
        <h3>ver0.1</h3>
        <button class="back-btn" onclick="history.back()">
            <i class="fa fa-chevron-left"></i> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
        </button>
    </div>

    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Filter</th>
                    <th>Emp ID</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                    <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                    <th>Create Date</th>
                    <th>Status</th>
                    <th>
                        <div class="action-header">
                            <span>Actions</span>
                            <button class="add-btn" id="addBtn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                        </div>
                    </th>

                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>


    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="addDataForm">
                <div class="form-group">
                    <label for="idNumber">ID Number:</label>
                    <input type="text" id="idNumber" name="idNumber" required>
                </div>
                <div class="form-group">
                    <label for="name">‡∏ä‡∏∑‡πà‡∏≠:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="department">‡πÅ‡∏ú‡∏ô‡∏Å:</label>
                    <select id="department" name="department" required>
                        <option value="tr">tr</option>
                        <option value="tvb">tvb</option>
                        <option value="tv3">tv3</option>
                        <option value="vg">vg</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="createDate">Create Date:</label>
                    <input type="date" id="createDate" name="createDate" required>
                </div>
                <div class="form-group">
                    <label for="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                    <select id="status" name="status" required>
                        <option value="‡∏¢‡∏∑‡∏°">‡∏¢‡∏∑‡∏°</option>
                        <option value="‡∏Ñ‡∏∑‡∏ô">‡∏Ñ‡∏∑‡∏ô</option>
                    </select>
                </div>
                <button type="submit" id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </form>
        </div>
    </div>

   <script>
const tableBody = document.getElementById("tableBody");
const addBtn = document.getElementById("addBtn");
const modal = document.getElementById("addModal");
const closeBtn = document.querySelector(".close-btn");
const addDataForm = document.getElementById("addDataForm");

// URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doGet / doPost (doPost ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏¢‡∏Å action ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)
const getUrl = "https://script.google.com/macros/s/AKfycbwz-z1ty6kkVseqn8KpjWCAi-xnv0qU_q0y0KCRcwcvpR1oqKgs0zi4vendHCu40FpdEA/exec";
const postUrl = "https://script.google.com/macros/s/AKfycbxKlXvbGubg8dRlGOUvGxkofwH61gbp7RjWmlNzpTLQCU9mjx6N_kK9IAqIhEHSHothLw/exec";

let editRow = null; // ‡πÄ‡∏Å‡πá‡∏ö row ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
async function fetchDataAndRenderTable() {
  try {
    const response = await fetch(getUrl);
    const data = await response.json();
    tableBody.innerHTML = '';

    let openDetail = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡πÑ‡∏´‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà

    data.forEach(rowData => {
      // üîπ ‡πÅ‡∏ñ‡∏ß‡∏´‡∏•‡∏±‡∏Å
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>-</td>
        <td>${rowData['ID Number']}</td>
        <td>${rowData['‡∏ä‡∏∑‡πà‡∏≠']}</td>
        <td>${rowData['‡πÅ‡∏ú‡∏ô‡∏Å']}</td>
        <td>${rowData['Create Date']}</td>
        <td>${rowData['Status']}</td>
        <td>
          <button class="action-btn edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="action-btn delete">‡∏•‡∏ö</button>
        </td>
      `;

      // üîπ ‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
      const detailTr = document.createElement("tr");
      detailTr.classList.add("details-row");
      detailTr.innerHTML = `
        <td colspan="7" class="details-cell">
          <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</strong><br>
          Category: ${rowData['category'] || '-'}<br>
          Company: ${rowData['company'] || '-'}<br>
          Assets ID: ${rowData['assets ID'] || '-'}<br>
          S/N: ${rowData['S/N'] || '-'}<br>
          Warranty: ${rowData['Warranty'] || '-'}<br>
          Locations: ${rowData['Locations'] || '-'}
        </td>
      `;

      // üîπ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
      tr.addEventListener("click", (e) => {
        // ‡∏Å‡∏±‡∏ô event ‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
        if (e.target.classList.contains("edit") || e.target.classList.contains("delete")) return;

        // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡∏õ‡∏¥‡∏î
        if (detailTr.classList.contains("open")) {
          detailTr.classList.remove("open");
          tr.classList.remove("selected");
          openDetail = null;
        } else {
          // ‡∏õ‡∏¥‡∏î‡πÅ‡∏ñ‡∏ß‡πÄ‡∏Å‡πà‡∏≤
          if (openDetail) {
            openDetail.detail.classList.remove("open");
            openDetail.row.classList.remove("selected");
          }
          // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ
          detailTr.classList.add("open");
          tr.classList.add("selected");
          openDetail = { row: tr, detail: detailTr };
        }
      });

      // üîπ ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      tr.querySelector(".edit").addEventListener("click", () => {
        editRow = rowData._row;
        document.getElementById("idNumber").value = rowData['ID Number'];
        document.getElementById("name").value = rowData['‡∏ä‡∏∑‡πà‡∏≠'];
        document.getElementById("department").value = rowData['‡πÅ‡∏ú‡∏ô‡∏Å'];
        document.getElementById("createDate").value = rowData['Create Date'];
        document.getElementById("status").value = rowData['Status'];
        modal.style.display = "block";
      });

      // üîπ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
      tr.querySelector(".delete").addEventListener("click", async () => {
        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
          try {
            const response = await fetch(postUrl, {
              method: 'POST',
              body: JSON.stringify({ action: "delete", row: rowData._row }),
              headers: { 'Content-Type': 'text/plain;charset=utf-8' }
            });
            const result = await response.json();
            if (result.status === "success") {
              alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
              fetchDataAndRenderTable();
            } else {
              alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + result.message);
            }
          } catch (err) {
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
          }
        }
      });

      tableBody.appendChild(tr);
      tableBody.appendChild(detailTr);
    });
  } catch (error) {
    console.error("Error fetching data:", error);
    tableBody.innerHTML = `<tr><td colspan="7">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
  }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
async function submitData(event) {
  event.preventDefault();
  const formData = new FormData(addDataForm);
  const data = {
    'ID Number': formData.get('idNumber'),
    '‡∏ä‡∏∑‡πà‡∏≠': formData.get('name'),
    '‡πÅ‡∏ú‡∏ô‡∏Å': formData.get('department'),
    'Create Date': formData.get('createDate'),
    'Status': formData.get('status'),
  };

  if (editRow) {
    data.action = "update";
    data.row = editRow;
  } else {
    data.action = "add";
  }

  try {
    const response = await fetch(postUrl, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'text/plain;charset=utf-8' }
    });
    const result = await response.json();
    if (result.status === 'success') {
      alert(editRow ? "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
      modal.style.display = "none";
      fetchDataAndRenderTable();
      editRow = null;
      addDataForm.reset();
    } else {
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message);
    }
  } catch (error) {
    alert(editRow ? '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ' : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
  }
}

// Event listeners
addBtn.addEventListener("click", () => {
  editRow = null;
  addDataForm.reset();
  modal.style.display = "block";
});
closeBtn.addEventListener("click", () => { modal.style.display = "none"; });
window.addEventListener("click", (event) => { if (event.target == modal) modal.style.display = "none"; });
addDataForm.addEventListener("submit", submitData);

document.addEventListener("DOMContentLoaded", fetchDataAndRenderTable);
</script>



</body>

</html>